@page "/"
@using CarInventory.Models
@using CarInventory.Components
@inject CarInventory.Data.AppDbContext Db

<PageTitle>Home</PageTitle>

<h1 class="mb-4">Available Cars</h1>

<InventorySearch Cars="AllCars" ResultsChanged="UpdateResults" />

@if (FilteredCars is null || !FilteredCars.Any())
{
    <p>No cars match your search.</p>
}
else
{
    <div class="row g-4 mt-3">
        @foreach (var car in FilteredCars)
        {
            <div class="col-12 col-md-6 col-lg-4">
                <CarCard Car="car" />
            </div>
        }
    </div>
}

@code {
    private List<Car> AllCars = new();
    private List<Car> FilteredCars = new();

    protected override void OnInitialized()
    {
        AllCars = Db.Cars.Where(c => !c.IsSold).ToList();
        FilteredCars = AllCars;
    }

    private void UpdateResults(List<Car> results)
    {
        FilteredCars = results;
        StateHasChanged();
    }
}